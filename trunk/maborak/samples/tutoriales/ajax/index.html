<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>A.J.A.X (Asynchronous Javascript And XML)</title>
<script type='text/javascript' src='../../../core/maborak.js'></script>
	<link rel="stylesheet" type="text/css" href="../../style.css" />
	<script type='text/javascript'>
	var leimnud = new maborak();
	leimnud.make();
	leimnud.Package.Load("validator,app,rpc,fx,drag,drop,panel,grid",{Instance:leimnud,Type:"module"});
	leimnud.Package.Load("json",{Type:"file"});
	leimnud.exec(leimnud.fix.memoryLeak);
	</script>
	<script type='text/javascript'>
	//var $ = document.getElementById;
	var openUrl=function(url,title)
	{
		var panelIframe = new leimnud.module.panel();
		var target = document.body;
		panelIframe.options={
			size:{w:((90*target.clientWidth)/100),h:((70*target.clientHeight)/100)},
			title	:title || "",
			target	:target,
			position:{center:true},
			statusBarButtons:[
			{value:"Código"},
			{value:"Recargar"}
			],
			fx:{modal:true}
		};
		panelIframe.setStyle={
			content:{padding:2,overflow:"hidden"},
			status:{textAlign:"left"}
		};
		panelIframe.make();
		var ifr = document.createElement("iframe");
		ifr.frameBorder=0;
		leimnud.dom.setStyle(ifr,{
			width:"100%",
			height:"100%",
			border:"0px solid red"
		});
		var textareaSource = document.createElement("textarea");
		leimnud.dom.setStyle(textareaSource,{
			width:"100%",
			height:"100%",
			display:"none",
			overflow:"scroll",
			border:"0px solid black"
		});
		textareaSource.readOnly=true;
		panelIframe.elements.statusBarButtons[0].onmouseup=function()
		{
			var sc = (ifr.Document || ifr.contentDocument).documentElement.innerHTML;
			ifr.style.display="none";
			textareaSource.style.display="";
			textareaSource.value="<HTML>\n"+sc+"\n</HTML>";
			panelIframe.elements.statusBarButtons[0].disabled=true;
			panelIframe.elements.statusBarButtons[0].blur();
		};
		panelIframe.elements.statusBarButtons[1].onmouseup=function()
		{
			ifr.style.display="";
			textareaSource.style.display="none";
			panelIframe.elements.statusBarButtons[0].disabled=false;
			(ifr.Document || ifr.contentDocument).location.reload();
		};
		panelIframe.addContent(ifr);
		panelIframe.addContent(textareaSource);
		ifr.src=url+"?rand="+Math.random() || "";
		panelIframe.addContentStatus("Abriendo página: <span style='color:black;'>"+url+"</span>");
	}
	var changeSkin=function(select)
	{
		//alert(select.options[select.selectedIndex].value)
		document.getElementById("stylesheet").href=select.options[select.selectedIndex].value;
	}
	</script>
	<link id="stylesheet" rel="stylesheet" type="text/css" href="styleWhite.css" />
</head>
<body>
<pre><div style="text-align:right;">Skin: <select style="font:normal 8pt Tahoma,MiscFixed" onchange="changeSkin(this);">
	<option value="styleWhite.css">White</option>
	<option value="styleBlack.css">Black</option>
	<option value="styleTextMode.css">Text Mode</option>
</select>
</div>
                  Asynchronous Javascript And XML (AJAX)
                 ----------------------------------------

Copyright © 2006-2007 Maborak Technologies Inc. (http://www.maborak.com)

2008-01-02

-----------------------------------------------------------------------------------


Tabla de Contenidos

1. Fundamentos

    1.1. Introducción
    1.2. Que NO es Ajax
    1.3. Formas similares de conexiones asincronas
    1.4. Javascript+DOM+XML+JSON
    1.5. Síncrono Vs Asíncrono
    
2. Vida fácil

    2.1. Editores
    2.2. Navegadores
    2.3. Depuradores
    2.4. Bibliografía
    
3. Objeto XMLHttpRequest

    3.1. Introducción
    3.2. Instancia
    3.3. Métodos
    3.4. Propiedades

4. Código

    4.1. Peticiones por método POST (paso a paso)
    4.2. Peticiones por método GET
    4.3. Respuesta text/plain
    4.4. Respuesta text/xml
    4.5. Peticiones síncronas

5. JSON

-----------------------------------------------------------------------------------

1. Fundamentos

    1.1. Introducción

    Ajax es el acrónimo para [A]synchronous [J]avascript [A]nd [X]ML mediante la cual
    rutinas, datos, etc. son intercambiados con el servidor ( Apache/PHP, Tomcat/JSP,
    IIS/ASP ) sin necesidad de recargar toda la página web o terminar un proceso 
    Javascript (asíncrono).
    
    De esta forma actualizas/quitas/agregas solo las partes necesarias de tu 
    aplicación, ahorrando ancho de banda y haciendolo dinámico. Es a lo que hoy en
    día se lo llama WEB 2.0.
    
    1.2. Que NO es Ajax
    
    Ajax no es:
    
    	* Un módulo de Apache
    	* Una extensión PHP
    	* Un plugin
    	* Una tecnología,
    	* Un archivo
    	* Un programa
    	* Un script

    1.3. Formas similares de conexiones asincronas

    	* Javascript Remote Scripting (JSRS)
    	* SOAP 
    	* XML-RPC (http://www.xmlrpc.com/)

    1.4. Javascript+DOM+XML+JSON+IFRAME

    Para aprender a usar esta metodología no esta demás decir que tus conocimientos
    sobre Javascript deben estar por lo menos en un nivel intermedio caso contrario 
    puedes arruinar tu sistema o la navegabilidad del mismo. Como dicen "si quieres 
    manejar un ferrari F-1 mínimo debes saber manejar".
    
    Para aprovechar al máximo este método debes tener un conocimiento claro y limpio 
    de la manipulacion de elementos DOM del navegador agregar, quitar, modificar el
    comportamiento del mismo.
    
    Para el intercambio de datos Cliente-Servidor es necesario (a largo alcanze) utilizar
    alguna tecnología como JSON (JavaScript Object Notation) o XML ya que el flujo que
    vayamos a necesitar puede consumir muchos recursos y necesitaremos dividir los 
    procesos acorde a las necesidades especificas de la aplicación.
    
    Ya que Ajax no es una tecnología en el pasado se utilizó "hacks" para realizar 
    peticiones asíncronas una de ellas era el uso de Iframes. La idea consistía en 
    cargar en un iframe oculto la url del servidor enviando datos por GET o por algun
    formulario POST y luego leer el contenido resultante del iframe y aplicarlo a lo
    que corresponda.
    
    1.4. Síncrono Vs Asíncrono
    
    Javascript interpreta el código linea por linea, esto quiere decir que no se pasa a
    interpretar la siguiente linea si la actual no ha terminado su proceso.
    
    Por ejemplo:
    
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
	1. var i = 9898;
	2. alert(i);
	3. var j = 22;
	4. alert(j);
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    En este ejemplo el interprete se detiene en la linea 2 mostrando el alert y se pasará
    a la linea 3 cuando se cierre el alert y así sucesivamente. Esto es un proceso síncrono.
    
    En el caso de asíncrono el interprete no se pone a la espera de que el proceso termine(se
    ejecuta el proceso en background) y pasa a la siguiente línea para su interprete.
    <span class="tcode">XMLHttpRequest</span> no es el único objeto asincrono, también tenemos a la función
    <span class="tcode">setTimeOut() y setInterval()</span>.
    
    XMLHttpRequest soporta peticiones síncronas y asíncronas, se usa una conexión asíncrona 
    cuando la aplicación hará multiples peticiones de forma independiente, pero en el caso
    de simplemente tener una petición a la vez, es mucho mas fácil usar una petición sincrona (se
    explicará mas adelante).
    
2. Vida fácil

    2.1. Editores
    
    Pueden usar cualquier editor para sus apicaciones dinámicas, algunos se sienten
    cómodos usando Ultraedit pero personalmente siento mayor comodidad usando:
    
    	Windows:
    	
    		* Zend Studio
    		* Komodo IDE Editor
    		* Aptana IDE
    		* Scite
    	
    	Linux:
    	
    		* Vim	( Es el que yo uso )
    		* Aptana IDE
    		* Zend Studio
    		* Scite
    
    De todos estos editores Aptana y Komodo están orientados a Ajax o Aplicaciones 
    Ricas de Internet ya que tienes su propio depurador y se acopla perfectamente 
    con muchos frameworks conocidos como Mootools, Prototype, etc.
    
    2.2. Navegadores
    
    	* Mozilla Firefox (http://www.mozilla.org), Navegador recomendado por excelencia
    	  ya que te facilita muchisimo la depuración, edición en caliente(Firebug), 
    	  edición de la hoja de estilos(Firebug, Web developer addon), rastreo de 
    	  Headers, etc.
    	* Microsoft Internet Explorer, los depuradores para Internet Explorer son
    	  muy pobres comparados con las herramientas de Mozilla Firefox.
    	* Opera (http://www.opera.com), excelente navegador con interprete javascript
    	  muy estricto. Úsese para casos de prueba
    	* Safari (http://www.apple.com/safari), nevagador web usando KHTML para su 
    	  interprete estricto. Úsese para casos de prueba.
    
    	Nota: Solo existen 4 tipos de navegadores:
    	
    			1.- Navegadores basados en Gecko de Mozilla (Mozilla firefox, Netscape,
    			    K-meleon, Epiphany).
    			2.- Microsoft Internet Explorer.
	    		3.- Opera.
    			4.- Navegadores basados en KHTML (Safari, Konqueror).
    		
    	      Existen muchos navegadores, pero generalmente estan basados en uno de estos
    	      motores para interpretar Html,Javascript,Css. 
    	      
    	      Con una aplicación compatible en estos 4 motores, oficialmente tienes una
    	      aplicación Crossbrowser.
    
    2.3. Depuradores
    
    No puedes tener una vida tranquila y fácil si no usas un depurador para tus aplicaciones
    entre ellas menciono.
    
    	Windows:
    		
    		* Firebug (http://www.getfirebug.com) Extensión de Mozilla Firefox.
    		* Firebug Minimal (http://www.getfirebug.com) Archivo javascript integrado en 
    		  cualquier navegador.
    		* Web Developer (http://addons.mozilla.org) Extensión de Mozilla Firefox.
    		* IE Inspector (http://www.ieinspector.com) Integrado en Microsoft Internet
    		  Explorer.
    		* DebugBar (http://www.debugbar.com) Integrado en Microsoft Internet Explorer.
    		* Aptana Debugger (http://www.aptana.org) Integrado en Aptana Editor para
    		  Mozilla Firefox.
    	
    	Linux
    	
    		* Firebug (http://www.getfirebug.com) Extensión de Mozilla Firefox.
    		* Web Developer (http://addons.mozilla.org) Extensión de Mozilla Firefox.
    		* Aptana Debugger (http://www.aptana.org) Integrado en Aptana Editor para
    		  Mozilla Firefox.
    
    2.4. Bibliografía
    
    	* Creating Web Pages with Asynchronous JavaScript and XML
    	  By: Edmond Woychowsky
    	  Publisher: Prentice Hall 
    	  Pub Date: Agosto 08, 2006 
    	  Pages: 432
    	  
    	* Ajax Hacks 
    	  By: Bruce W. Perry
    	  Publisher: O'reilly
    	  Pud Date: Marzo 2006
    	  Pages: 438
    	  
    	* Ajax Design Patterns 
    	  By: Michael Mahemoff 
    	  Publisher: O'Reilly 
    	  Pub Date: Junio 2006 
    	  Pages: 655 
    	  
    	* Ajax for Web Application Developers 
    	  By: Kris Hadlock 
    	  Publisher: Sams 
    	  Pub Date: October 30, 2006 
    	  Pages: 288 
    	  
    	* Ajax Bible 
    	  By: Steven Holzner
    	  Publisher: John Wiley & Sons
    	  Pub Date: 2007
    	  Pages: 716
    	  
    	* Javascript Phrasebook: Essential Code and Commands 
    	  By: Christian Wenz 
    	  Publisher: Sams 
    	  Pub Date: August 28, 2006 
    	  Pages: 240 

    	* Javascript Bible, Gold Edition
    	  By: Danny Goodman
    	  Publisher: Hungry Minds, Inc.
    	  Pages: 2177
    	  
    	* Javascript Aplication Cookbook
    	  By: Jerry Brandenbaugh
    	  Publisher: O'Reilly
    	  Pub Date: Septembre 1999
    	  Pages: 476
    	  
    	* DOM Scripting
    	  By: Jeremy Keith
    	  Publisher: Friendsoft
    	  Pages: 369
    	  
    Por lo menos tienes que leer uno de estos buenísimos libros, recomiendo  
    (Ajax Hacks, Javascript Bible). Si no alcanzaron a leer alguno de estos, ni sueñen
    en tener una aplicación mantenible, escalable y crossbrowser.
	
3. Objeto XMLHttpRequest

    3.1. Introducción

    Ya que Ajax es un método y no una tecnología usaremos uno de esos métodos, el cual
    es usar el Objeto nativo ( Mozilla/Opera/Safari/Gecko ) y ActiveX ( Microsoft
    Internet Explorer ) llamado XMLHttpRequest, mediante el cual puedes hacer peticiones
    Asíncronas y Síncronas.
    
    3.2. Instancia
    
    Lamentablemente el Objeto XMLHttpRequest se lo instancia de diferentes formas según
    el navegador web, por lo tanto haremos un Objeto XMLHttpRequest Crossbrowser  ( que
    funcione en todos los navegadores por igual ).
    
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
var XMLHttpObject = function()
{
	try{
		var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	}
	catch(e)
	{
		try
		{
			var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		catch(e)
		{
			var xmlhttp = false;
		}
	}
	return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
	new XMLHttpRequest():xmlhttp || new function(){};
}
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
	
    Instanciamos al objeto.
	
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
    var rpc = new XMLHttpObject();
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
    
    Con esto ya tenemos el objeto para trabajar, ahora detallaré sus métodos y propiedades.
    
    
    3.3. Métodos
    
	---------------------------------------------------------------------------------------
	|    Método                       |  Descripción                                      |
	|-------------------------------------------------------------------------------------|
	|                                 |                                                   |
	| abort()                         |  Cancela la actual peticion HTTP.                 |
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| getAllResponseHeaders(label)    |  Retorna en una cadena todas las cabeceras HTTP.  |
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| getResponseHeader(label)        |  Retorna un valor específico de las cabeceras HTTP|
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| open(method,URL,asynchFlag)     |  Inicializa la peticion XMLHttp.                  |
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| send(content)                   |  Envia la peticion al servidor esperando su       |
	|                                 |  respuesta.                                       |
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| setRequestHeader(label,value)   |  Añade una cabecera y un valor HTTP al momento de |
	|                                 |  enviar el contenido.                             |
	---------------------------------------------------------------------------------------

	
    3.4. Propiedades
    
	---------------------------------------------------------------------------------------
	|   Propiedad                     |   Descripción                                     |
	|-------------------------------------------------------------------------------------|
	|                                 |                                                   |
	| status                          |  Contiene el código de estado retornado por la    |
	|                                 |  peticion HTTP. Read-only.                        |
	|                                 |                                                   |
	|                                 |  Lista de estados:                                |
	|                                 |                                                   |
	|                                 |    200 OK                                         |
	|                                 |    201 Created                                    |
	|                                 |    204 No Content                                 |
	|                                 |    205 Reset Content                              |
	|                                 |    206 Partial Content                            |
	|                                 |    400 Bad Request                                |
	|                                 |    401 Unauthorized                               |
	|                                 |    403 Forbidden                                  |
	|                                 |    404 Not Found                                  |
	|                                 |    405 Method Not Allowed                         |
	|                                 |    406 Not Acceptable                             |
	|                                 |    407 Proxy Authentication Required              |
	|                                 |    408 Request Timeout                            |
	|                                 |    411 Length Required                            |
	|                                 |    413 Requested Entity Too Large                 |
	|                                 |    414 Requested URL Too Long                     |
	|                                 |    415 Unsupported Media Type                     |
	|                                 |    500 Internal Server Error                      |
	|                                 |    501 Not Implemented                            |
	|                                 |    502 Bad Gateway                                |
	|                                 |    503 Service Unavailable                        |
	|                                 |    504 Gateway Timeout                            |
	|                                 |    505 HTTP Version Not Supported                 |
	|                                 |                                                   |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| statusText                      |  Contiene la de estado retornado por la peticion  |
	|                                 |  HTTP.                                            |
	|                                 |  Por ejemplo:                                     |
	|                                 |                                                   |
	|                                 |    200-> retorna "OK"                             |
	|                                 |    501-> retorna "Not Implemented"                |
	|                                 |                                                   |
	|                                 |  Read-only.                                       |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| readyState                      |  Contiene el estado actual de la peticion HTTP.   |
	|                                 |                                                   |
	|                                 |    0 uninitialized                                |
	|                                 |    1 loading                                      |
	|                                 |    2 loaded                                       |
	|                                 |    3 interactive                                  |
	|                                 |    4 complete                                     |
	|                                 |                                                   |
	|                                 |  Read-only.                                       |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| onreadystatechange              |  Función a la que se llamara cuando el objeto     |
	|                                 |  cambie de estado (leer readyState).              |
	|                                 |                                                   |
	|                                 |  Read/Write.                                      |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| responseText                    |  Contiene la respuesta del servidor en texto      |
	|                                 |  plano.                                           |
	|                                 |                                                   |
	|                                 |  Read-only.                                       |
	|---------------------------------|---------------------------------------------------|
	|                                 |                                                   |
	| responseXML                     |  Contiene la respuesta del servidor como documento|
	|                                 |  XML.                                             |
	|                                 |                                                   |
	|                                 |  Read-only                                        |
	---------------------------------------------------------------------------------------

4. Código

    4.1. Peticiones por método POST (paso a paso)
    
    Para este primer ejemplo haremos una peticion por el método POST a nuestro servidor.
    
    	1.- Instanciamos el objeto
    	
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
var XMLHttpObject = function()
{
	try{
		var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	}
	catch(e)
	{
		try
		{
			var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		catch(e)
		{
			var xmlhttp = false;
		}
	}
	return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
	new XMLHttpRequest():xmlhttp || new function(){};
}
var rpc = new XMLHttpObject();
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    	2.- Iniciamos la petición definiendo el método ("POST") la url ("ejemplo1_server.php")
    	    y la bandera de petición asincrona (true).

<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
rpc.open("POST","ejemplo1_server.php",true);
rpc.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    	Nota: Todo método POST debe tener el header:
    	
    	           <span class="tcode">"Content-Type","application/x-www-form-urlencoded"</span>
    	
    	      <span class="tcode">encodeURI()</span> Devuelve una cadena en la que todos
    	      los caracteres no-alfanuméricos excepto -_. han sido reemplazados con un 
    	      signo de porcentaje (%) seguido por dos dígitos hexadecimales y los espacios
    	      son codificados como signos de suma (+). Esta es la misma codificación usada
    	      en los datos publicados desde un formulario WWW, es decir, el mismo mecanismo
    	      usado para el tipo de medios application/x-www-form-urlencoded.
    	      Este mecanismo difiere de la codificación RFC1738 (vea <span class="tcode">encodeURIComponent()</span>) en que,
    	      por razones históricas, los espacios son codificados como signos de suma (+).
    	      Esta función es conveniente cuando se codifica una cadena a ser usada como la
    	      parte de consulta de una URL, como método práctico para pasar variables a la 
    	      siguiente página.

    	3.-  Enviamos la peticion al servidor en espera de respuesta.

<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
rpc.send(encodeURI("param1=parametro1&amp;param2=parametro2&amp;param3=Hola mundo"));
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

            Dentro del contenido enviaremos variables como cadena(separadas por &amp;).
            	
    	           <span class="tcode">var1=algo</span>
    	           <span class="tcode">var2=otro</span>
    	           
    	           		quedando
    	           		
    	           <span class="tcode">var1=algo&amp;var2=otro</span>

    	4.- Definimos la función que se llamará en cada cambio de estado y condicionamos
    	    que si el estado (rpc.readyState) sea igual a 4 mostr emos un alert con la
    	    respuesta del servidor (rpc.responseText).
    	
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
rpc.onreadystatechange=function()
{
	if(rpc.readyState===4)
	{
		alert(rpc.responseText);
	}
}
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    	Y es todo, con estos 4 simples pasos hemos hecho una peticion HTTP de forma asincrona.
    	
    	Ahora todo en uno.
    	
    <b>ejemplo1.html</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
	var XMLHttpObject = function()
	{
		try{
			var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
		}
		catch(e)
		{
			try
			{
				var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			catch(e)
			{
				var xmlhttp = false;
			}
		}
		return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
		new XMLHttpRequest():xmlhttp || new function(){};
	}
	var rpc = new XMLHttpObject();
	rpc.open("POST","ejemplo1_server.php",true);
	rpc.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	rpc.send(encodeURI("param1=parametro1&amp;param2=parametro2&amp;param3=Hola mundo"));
	rpc.onreadystatechange=function()
	{
		if(rpc.readyState===4)
		{
			alert(rpc.responseText);
		}
	}
&lt;/script&gt;
&lt;/head&gt;
&lt;/html&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    <b>ejemplo1_server.php</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;?php
echo "variables  POST:\n";
print_r($_POST);
echo "variables  GET:\n";
print_r($_GET);
?&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    El resultado es:
    
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
variables  POST:
Array
(
    [param1] => parametro1
    [param2] => parametro2
    [param3] => Hola mundo
)
variables  GET:
Array
(
)
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
	
    <input type="button" onclick="openUrl('ejemplo1.html','Primer acercamiento con el método POST'); return false;" value="Ver ejemplo"/>
    
    Con este pequeño código ya hemos tenido un primer acercamiento a este método. Para
    entender mejor el código y monitorear las peticiones, pueden activar el depurador
    Firebug (explicado mas arriba).
    
    4.2. Peticiones por método GET
    
    Hacer una petición por método GET es igual de simple que el método POST con diferencia
    de un par de líneas (se daran cuenta cuales).
    
    <b>ejemplo2.html</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
	var XMLHttpObject = function()
	{
		try{
			var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
		}
		catch(e)
		{
			try
			{
				var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			catch(e)
			{
				var xmlhttp = false;
			}
		}
		return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
		new XMLHttpRequest():xmlhttp || new function(){};
	}
	var rpc = new XMLHttpObject();
	rpc.open("GET","ejemplo1_server.php?param1=parametro1&param2=parametro2&param3=Hola mundo",true);
	rpc.send(null);
	rpc.onreadystatechange=function()
	{
		if(rpc.readyState===4)
		{
			alert(rpc.responseText);
		}
	}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
    </pre>
    
    <b>ejemplo2_server.php</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;?php
echo "variables  POST:\n";
print_r($_POST);
echo "variables  GET:\n";
print_r($_GET);
?&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    El resultado por GET:
    
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
variables  POST:
Array
(
)
variables  GET:
Array
(
    [param1] => parametro1
    [param2] => parametro2
    [param3] => Hola mundo
)
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
    
    <input type="button" onclick="openUrl('ejemplo2.html','Peticiones por método GET'); return false;" value="Ver ejemplo"/>
    
    4.3. Respuesta text/plain
    
    Para procesar la respuesta del servidor como texto plano se debe usar el método <span class="tcode">responseText()</span>,
    de esta manera podemos manipular la respuesta en nuestros objetos DOM o bien recibir
    texto plano en formato JSON y manipularlo directamente como datos de aplicación.
    
    En este ejemplo recibiremos texto plano y lo incrustaremos en una parte (un bloque DIV)
    de nuestra página HTML.
    
    <b>ejemplo3.html</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
var XMLHttpObject = function()
{
	try{
		var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	}
	catch(e)
	{
		try
		{
			var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		catch(e)
		{
			var xmlhttp = false;
		}
	}
	return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
	new XMLHttpRequest():xmlhttp || new function(){};
}
var incrustar=function()
{
	var rpc = new XMLHttpObject();
	var div	= document.getElementById("target");
	div.innerHTML="Cargando......";
	rpc.open("POST","ejemplo3_server.php",true);
	rpc.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	rpc.send();
	rpc.onreadystatechange=function()
	{
		if(rpc.readyState===4)
		{
			div.innerHTML = rpc.responseText;
		}
	}
}
&lt;/script&gt;
&lt;style&gt;
body
{
	font:normal 11px sans-serif;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
Vestibulum semper. Nullam non odio. Aliquam quam. Vestibulum semper. Nullam non odio.&lt;br&gt;
Aliquam quam. Vestibulum semper. Nullam non odio. Aliquam quam. Vestibulum semper.&lt;br&gt;
Nullam non odio. Aliquam quam. Vestibulum semper. Nullam non odio. Aliquam quam.&lt;br&gt;
&lt;div id="target" style="border:1px solid #EEE;padding:5px;color:#006699;"&gt;
&lt;/div&gt;
&lt;a href="#" onclick="incrustar(); return false;"&gt;Solicitar datos&lt;/a&gt;&lt;br&gt;
Vestibulum semper. Nullam non odio. Aliquam quam. Vestibulum semper. Nullam non odio.&lt;br&gt;
Aliquam quam. Vestibulum semper. Nullam non odio. Aliquam quam. Vestibulum semper.&lt;br&gt;
Nullam non odio. Aliquam quam. Vestibulum semper. Nullam non odio. Aliquam quam.&lt;br&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
	
    <b>ejemplo3_server.php</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
Vestibulum semper. &lt;b&gt;Nullam non odio&lt;/b&gt;. Aliquam quam. Vestibulum semper.
Aliquam quam. Vestibulum semper. &lt;u&gt;nullam non odio. Aliquam quam&lt;/u&gt;.
&lt;ol&gt;
	&lt;li&gt;Blabla&lt;/li&gt;
	&lt;li&gt;Blabla&lt;/li&gt;
	&lt;li&gt;Blabla&lt;/li&gt;
	&lt;li&gt;Blabla&lt;/li&gt;
&lt;/ol&gt;
Nullam non odio. Aliquam quam. Vestibulum semper. Nullam non odio. Aliquam quam.
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
    
    <input type="button" onclick="openUrl('ejemplo3.html','Respuesta text/plain'); return false;" value="Ver ejemplo"/>
    
    4.4. Respuesta text/xml
    
    Para procesar la respuesta se debe usar el método <span class="tcode">responseXML()</span>,para convertirlo en un objeto
    <span class="tcode">XMLDocument</span> pudiendo acceder a sus nodos y atributos con <span class="tcode">nodo.getElementsByTagName("nodo")</span> y así
    de forma recursiva.
    
    	* <span class="tcode">DocumentXML.getElementsByTagName("nodo")</span>, Devuelve un Array de Nodos.
    	* <span class="tcode">Nodo[0].firstChild.nodeValue</span>, Devuelve el contenido del Nodo.
    	* <span class="tcode">Nodo[0].getAttribute("atributo")</span>, Devuelve el valor de un atributo del
    	  actual Nodo.
    	* <span class="tcode">Nodo[0].attributes</span>, Devuelve un Array de atributos del actual Nodo.
    	* <span class="tcode">Nodo[0].attributes[0].nodeValue</span>, Devuelve el valor de un atributo en el
    	  indice actual.
    
    Se puede usar Firebug para acceder a todas las propiedades y métodos de los Nodos
    de esta forma:
    
    	1.- Guardar en una variable global el contenido del Nodo o XMLDocument
    		<span class="tcode">window.inspector = Nodo[0]</span> o <span class="tcode">window.inspector = rpc.responseXML</span>
    	2.- Abrir la pestaña <span class="tcode">Script</span> en Firebug y añadir a <span class="tcode">New watch expression</span> la 
    	    cadena <span class="tcode">window.inspector</span>
    	3.- Navegar por el arbol DOM que genera Firebug.
    
    Para evitar errores con el objeto XML se debe enviar Headers indicando que se va a
    responder con un documento XML.
    
    	* <span class="tcode">&lt;?xml version="1.0" ?&gt;</span> : en caso de ser un <span class="tcode">documento.xml</span>.
    	* <span class="tcode">header('Content-Type: text/xml');</span> : En el caso de crear el documento XML mediante PHP.
    	* Enviar cabeceras <span class="tcode">text/xml</span> de acuerdo a la tecnología usada en el servidor.
    	
    También se puede usar Firebug para examinar los nodos como DOM Object.

    <b>ejemplo4.html</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;script type="text/javascript"&gt;
var XMLHttpObject = function()
{
	try{
		var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	}
	catch(e)
	{
		try
		{
			var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		catch(e)
		{
			var xmlhttp = false;
		}
	}
	return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
	new XMLHttpRequest():xmlhttp || new function(){};
}
window.onload=function()
{
	var rpc = new XMLHttpObject();
	var target = document.getElementById("target");
	rpc.open("POST","musica.xml",true);
	rpc.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	rpc.send();
	rpc.onreadystatechange=function()
	{
		if(rpc.readyState===4)
		{
			var DocumentXML = rpc.responseXML;
			var banda = DocumentXML.getElementsByTagName("banda");
			parent.window.ss=banda;
			for(var i=0;i&lt;banda.length;i++)
			{
				target.innerHTML+= banda[i].firstChild.nodeValue+"&lt;br&gt;";
				target.innerHTML+= "::Género:"+banda[i].getAttribute("genero")+"&lt;br&gt;";
			}
			target.innerHTML+="&lt;br&gt;&lt;br&gt;------------ Response Text ------------&lt;br&gt;";
			target.appendChild(document.createTextNode(rpc.responseText));
		}
	}
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre id="target"&gt;
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
    
    <b>musica.xml</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;?xml version="1.0" ?&gt;
&lt;listado&gt;
	&lt;banda genero="Electro dark"&gt;&lt;![CDATA[Hocico]]&gt;&lt;/banda&gt;
	&lt;banda genero="Gothic Metal"&gt;&lt;![CDATA[Lacuna coil]]&gt;&lt;/banda&gt;
	&lt;banda genero="Gothic Rock"&gt;&lt;![CDATA[Zeraphine]]&gt;&lt;/banda&gt;
&lt;/listado&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>

    <input type="button" onclick="openUrl('ejemplo4.html','Respuesta text/xml'); return false;" value="Ver ejemplo"/>

    4.5. Peticiones síncronas
    
    Para realizar una petición síncrona:
    
    	1.- Poner en <i>false</i> el tercer parametro del método <span class="tcode">open(method,URL,asynchFlag)</span>. ¡Importante!
    	2.- La propiedad <span class="tcode">onreadystatechange</span> ya no es leída porque en  la petición sincrona
    	    no cambia la propiedad <span class="tcode">readyState</span>. Tomarlo como Nota.

    <b>ejemplo5.html</b>
<pre class="headerCode"><br>------------- Code begin -------------</br></pre><pre class="code">
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;script type="text/javascript"&gt;
var XMLHttpObject = function()
{
	try{
		var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	}
	catch(e)
	{
		try
		{
			var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		catch(e)
		{
			var xmlhttp = false;
		}
	}
	return (!xmlhttp && typeof XMLHttpRequest!='undefined')?
	new XMLHttpRequest():xmlhttp || new function(){};
}
var asin = function()
{
	var rpc = new XMLHttpObject();
	var target = document.getElementById("target");
	target.innerHTML="Loading......";
	rpc.open("POST","ejemplo1_server.php",false);
	rpc.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	rpc.send(encodeURI("param1=parametro1&param2=parametro2&param3=Hola mundo"));
	target.innerHTML = rpc.responseText;
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;
&lt;a href="#" onclick="asin(); return false;"&gt;Cargar petición síncrona&lt;/a&gt;
&lt;/pre&gt;
&lt;pre id="target"&gt;
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><pre class="headerCode">------------- Code end -------------</br></pre>
    	    
    <input type="button" onclick="openUrl('ejemplo5.html','Peticion asíncrona'); return false;" value="Ver ejemplo"/>
    
</pre>
</body>
</html>




























